name: Lint and Static Analysis

on:
  workflow_call:  
    inputs:
      example_input:
        required: true
        type: string

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      # Step 1: Lint C code with clang-format
      - name: Lint C code with clang-format
        run: |
          clang-format -n -i *.c *.h  # Check if files are correctly formatted

      # Step 2: Static analysis with cppcheck
      - name: Run static analysis with cppcheck
        run: |
          cppcheck --enable=all --inconclusive --force --xml --xml-version=2 *.c *.h 2> reports/cppcheck_report.xml
          if [ $? -ne 0 ]; then
            echo "Cppcheck found issues!"
            exit 1
          fi
          cat reports/cppcheck_report.xml  # Show cppcheck results in the log

      # Step 3: Run Clang Static Analyzer
      - name: Run Clang Static Analyzer

        run: |
          scan-build clang -c *.c
          if [ $? -ne 0 ]; then
            echo "Clang Static Analyzer found issues!"
            exit 1
          fi  
      # Step 4: Run Valgrind for memory leak detection
      - name: Run Valgrind (memory leak check)
        run: |
          valgrind --leak-check=full --error-exitcode=1 ./my_program

      # Step 5: Run code complexity analysis with Lizard
      - name: Run code complexity analysis with Lizard
        run: |
          lizard --max-cc 10 *.c *.h > reports/lizard_report.txt
          cat reports/lizard_report.txt  # Show Lizard results in the log

      # Step 6: Generate documentation with Doxygen
      - name: Generate documentation with Doxygen
        run: |
          doxygen Doxyfile  # Ensure Doxyfile is set up correctly
