name: C Project Build and Test

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest # Run on Ubuntu runner

    steps:
      # Step 1: Checkout the code
      - name: Checkout code
        uses: actions/checkout@v4

      # Step 2: Set up build tools
      - name: Set up Build Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential cmake clang cppcheck

      # Step 3: Install dependencies (if any, e.g., for external libraries)
      - name: Install dependencies
        run: |
          sudo apt-get install -y libssl-dev  

      # Step 4: Run static analysis (Clang-Tidy, CppCheck)
      - name: Run Clang-Tidy for static analysis
        run: |
          clang-tidy $(find . -name "*.c") -- -I./include  # Adjust include path if needed

      - name: Run Cppcheck for static analysis
        run: |
          cppcheck --enable=all --inconclusive --force --quiet .

      # Step 5: Run pre-commit hooks (optional but recommended)
      - name: Run pre-commit hooks
        run: |
          pip install pre-commit
          pre-commit install  # Ensure hooks are set up
          pre-commit run --all-files  # Run pre-commit hooks on all files

      # Step 6: Compile the C project (using Makefile or CMake)
      - name: Build with CMake
        run: |
          mkdir -p build
          cd build
          cmake ..
          make textEditor.c

      # Step 7: Run unit tests
      - name: Run Unit Tests
        run: |
          cd build
          make test # Assumes 'make test' runs the unit tests

      # Step 8: Generate code coverage (optional)
      - name: Generate code coverage (optional)
        run: |
          cd build
          make coverage  # Assumes 'make coverage' generates the coverage reports

          # Upload coverage report if desired
          mkdir -p coverage
          cp coverage/lcov-report.html coverage/

      # Step 9: Post-build cleanup (optional)
      - name: Cleanup (optional)
        run: |
          sudo apt-get clean
          rm -rf build  # Clean up temporary build files
